# POP-Moderation API 文档

**模型名称**：POP-Moderation（泡泡审核）  
**模型参数量**：0.5B  
**模型类型**：审核模型 
**当前版本**：v1.0.0  
**最后更新**：2025年11月

---

## 一、模型概述

POP-Moderation（泡泡审核）是专为内容审核场景优化的轻量级模型，基于0.5B参数架构，针对中文及多语言违规内容检测进行了专项训练。模型支持标准审核接口和OpenAI兼容格式，可快速集成至现有系统中。

**核心能力**：
- 文本违规检测
- 多轮对话上下文审核
- 高准确率（违规召回率>95%）

---

## 二、API 端点

### 1. 标准审核接口

**端点**：`POST /v1/moderation`  
**描述**：直接传入文本进行审核，返回结构化检测结果

#### 请求格式

```http
POST /v1/moderation HTTP/1.1
Content-Type: application/json

{
  "text": "待审核的文本内容"
}
```

**参数说明**：
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `text` | string | 是 | 待审核文本，最大长度8192字符 |

#### 响应格式

```json
{
  "id": "mod_xxxxxxxx",
  "model": "pop-moderation-v1",
  "results": [
    {
      "flagged": true,
      "categories": {
        "political": true,
        "pornographic": false,
        "violence": false,
        "fraud": true,
        "insult": false,
        "contraband": false
      },
      "category_scores": {
        "political": 0.92,
        "pornographic": 0.01,
        "violence": 0.05,
        "fraud": 0.88,
        "insult": 0.12,
        "contraband": 0.00
      }
    }
  ]
}
```

**字段说明**：
- `flagged`：是否检测到违规（布尔值）
- `categories`：各违规类型检测结果（布尔值）
- `category_scores`：各违规类型置信度分数（0-1）

---

### 2. OpenAI 兼容接口

**端点**：`POST /v1/chat/completions`  
**描述**：兼容OpenAI格式的对话审核接口，**系统消息将被自动忽略**

#### 请求格式

```http
POST /v1/chat/completions HTTP/1.1
Content-Type: application/json

{
  "model": "pop-moderation",
  "messages": [
    {"role": "user", "content": "你好"},
    {"role": "assistant", "content": "我不好"}
  ]
}
```

**特殊说明**：
- **系统消息（system）将被完全忽略**，不参与推理
- 模型会自动将多轮消息按顺序拼接，格式为：`{user_content}\n{assistant_content}\n...`
- 仅支持`user`和`assistant`角色，其他角色将返回400错误

**拼接示例**：
```json
// 输入消息
[
  {"role": "user", "content": "你好"},
  {"role": "assistant", "content": "我不好"}
]

// 实际审核内容（自动拼接）
"你好\n我不好"
```

#### 响应格式

```json
{
  "id": "chatcmpl_xxxxxxxx",
  "object": "chat.completion",
  "model": "pop-moderation",
  "choices": [
    {
      "index": 0,
      "message": {
        "role": "assistant",
        "content": "{\"flagged\": true, \"categories\": {\"political\": false, \"pornographic\": false, \"violence\": true, \"fraud\": false, \"insult\": false, \"contraband\": false}, \"category_scores\": {\"political\": 0.05, \"pornographic\": 0.02, \"violence\": 0.89, \"fraud\": 0.01, \"insult\": 0.03, \"contraband\": 0.00}}"
      },
      "finish_reason": "stop"
    }
  ],
  "usage": {
    "prompt_tokens": 12,
    "completion_tokens": 1,
    "total_tokens": 13
  }
}
```

**注意**：审核结果以JSON字符串形式返回在`choices[0].message.content`中，需客户端解析。

---

## 三、错误码

| HTTP状态码 | 错误码 | 说明 |
|------------|--------|------|
| 200 | - | 请求成功 |
| 400 | `invalid_request` | 请求格式错误，如缺少text字段、角色非法 |
| 413 | `content_too_large` | 文本超过8192字符限制 |
| 429 | `rate_limit_exceeded` | 超出速率限制 |
| 500 | `internal_error` | 服务器内部错误 |
| 503 | `model_overloaded` | 模型负载过高 |

---
---

##四、注意事项

1. **系统消息忽略**：使用`/v1/chat/completions`时，请勿依赖system消息传递业务参数
2. **上下文长度**：总拼接长度不得超过8192字符，否则自动截断
3. **结果缓存**：相同文本10秒内重复请求会命中缓存
4. **非LLM声明**：本模型不具备文本生成能力，仅用于审核分类

---

## 六、更新日志

- **v1.0.0** (2025-11-22)：初始版本发布，支持双接口模式
